import logging


class Calculator:
    def __init__(self, log_file='calculator.log'):
        self.setup_logging(log_file)
        self.logger.info("Calculator initialized")
    
    def setup_logging(self, log_file):
        logging.basicConfig(
            filename=log_file,
            level=logging.INFO,
            format='%(asctime)s - %(levelname)s - %(message)s',
            datefmt='%Y-%m-%d %H:%M:%S'
        )
        self.logger = logging.getLogger(__name__)
    
    def add(self, a, b):
        try:
            result = a + b
            self.logger.info(f"Addition: {a} + {b} = {result}")
            return result
        except Exception as e:
            self.logger.error(f"Error in addition: {e}")
            raise
    
    def subtract(self, a, b):
        try:
            result = a - b
            self.logger.info(f"Subtraction: {a} - {b} = {result}")
            return result
        except Exception as e:
            self.logger.error(f"Error in subtraction: {e}")
            raise
    
    def multiply(self, a, b):
        try:
            result = a * b
            self.logger.info(f"Multiplication: {a} * {b} = {result}")
            return result
        except Exception as e:
            self.logger.error(f"Error in multiplication: {e}")
            raise
    
    def divide(self, a, b):
        try:
            if b == 0:
                error_msg = "Division by zero is not allowed"
                self.logger.warning(f"Attempted division by zero: {a} / {b}")
                raise ZeroDivisionError(error_msg)
            result = a / b
            self.logger.info(f"Division: {a} / {b} = {result}")
            return result
        except ZeroDivisionError:
            raise
        except Exception as e:
            self.logger.error(f"Error in division: {e}")
            raise


def get_number(prompt):
    while True:
        try:
            return float(input(prompt))
        except ValueError:
            print("Invalid input! Please enter a valid number.")
        except Exception as e:
            print(f"An error occurred: {e}")


def display_menu():
    print("\n" + "="*40)
    print("         CALCULATOR")
    print("="*40)
    print("1. Addition (+)")
    print("2. Subtraction (-)")
    print("3. Multiplication (*)")
    print("4. Division (/)")
    print("5. View Calculation History")
    print("6. Exit")
    print("="*40)


def view_history(log_file='calculator.log'):
    try:
        with open(log_file, 'r') as f:
            lines = f.readlines()
            if lines:
                print("\n" + "="*40)
                print("     CALCULATION HISTORY")
                print("="*40)
                for line in lines:
                    print(line.strip())
                print("="*40)
            else:
                print("\nNo calculation history available yet.")
    except FileNotFoundError:
        print("\nNo calculation history available yet.")
    except Exception as e:
        print(f"\nError reading history: {e}")


def main():
    calc = Calculator()
    
    print("\nWelcome to the Calculator!")
    
    while True:
        try:
            display_menu()
            choice = input("\nEnter your choice (1-6): ").strip()
            
            if choice == '6':
                print("\nThank you for using the Calculator. Goodbye!")
                calc.logger.info("Calculator session ended")
                break
            
            if choice == '5':
                view_history()
                continue
            
            if choice not in ['1', '2', '3', '4']:
                print("\nInvalid choice! Please select 1-6.")
                continue
            
            num1 = get_number("Enter the first number: ")
            num2 = get_number("Enter the second number: ")
            
            if choice == '1':
                result = calc.add(num1, num2)
                print(f"\nResult: {num1} + {num2} = {result}")
            
            elif choice == '2':
                result = calc.subtract(num1, num2)
                print(f"\nResult: {num1} - {num2} = {result}")
            
            elif choice == '3':
                result = calc.multiply(num1, num2)
                print(f"\nResult: {num1} * {num2} = {result}")
            
            elif choice == '4':
                try:
                    result = calc.divide(num1, num2)
                    print(f"\nResult: {num1} / {num2} = {result}")
                except ZeroDivisionError as e:
                    print(f"\nError: {e}")
        
        except KeyboardInterrupt:
            print("\n\nCalculator interrupted by user.")
            calc.logger.info("Calculator session interrupted by user")
            break
        except Exception as e:
            print(f"\nAn unexpected error occurred: {e}")
            calc.logger.error(f"Unexpected error: {e}")


if __name__ == "__main__":
    main()
